# API 仕様書

## 1. API 概要

この API 仕様書は、個人資産管理アプリの各種機能にアクセスするための API の設計に関するものです。主に、ユーザー認証、資産データの管理、目標設定、ポートフォリオ管理、データの取得・更新を行う API が含まれます。

---

## 2. 認証方式

- **認証方法**: JSON Web Token (JWT)による認証
  - ユーザーがログイン後、JWT トークンを受け取り、以降のリクエストの`Authorization`ヘッダーにこのトークンを含めることで、ユーザーが認証されます。
  - トークンが無効な場合、401 エラー（Unauthorized）を返却。

---

## 3. エンドポイント

### 3.1. ユーザー認証 API

#### 3.1.1. ログイン

- **URL**: `/api/v1/auth/login`
- **メソッド**: `POST`
- **リクエストボディ**:
  - `email`: ユーザーのメールアドレス
  - `password`: ユーザーのパスワード
- **レスポンス**:
  - 成功:
    - `access_token`: JWT トークン
    - `expires_in`: トークンの有効期限（秒）
  - 失敗:
    - エラーメッセージ: 認証エラー

#### 3.1.2. ログアウト

- **URL**: `/api/v1/auth/logout`
- **メソッド**: `POST`
- **リクエストヘッダー**:
  - `Authorization`: `Bearer {jwt_token}`
- **レスポンス**:
  - 成功:
    - メッセージ: ログアウト成功
  - 失敗:
    - エラーメッセージ: トークン無効

---

### 3.2. 目標設定 API

#### 3.2.1. 目標金額の取得

- **URL**: `/api/v1/goals`
- **メソッド**: `GET`
- **リクエストヘッダー**:
  - `Authorization`: `Bearer {jwt_token}`
- **レスポンス**:
  - 成功:
    - 目標のリスト（目標名、必要金額、必要時期など）
  - 失敗:
    - エラーメッセージ: 認証エラー

#### 3.2.2. 目標金額の設定・更新

- **URL**: `/api/v1/goals`
- **メソッド**: `POST` または `PUT`
- **リクエストボディ**:
  - `goal_name`: 目標名
  - `target_amount`: 必要金額
  - `target_date`: 必要時期
  - `annual_interest_rate`: 年利
  - `monthly_contribution`: 月々の積立額
- **レスポンス**:
  - 成功:
    - メッセージ: 目標の作成または更新が成功したことを示すメッセージ
  - 失敗:
    - エラーメッセージ: 作成または更新に失敗した理由

---

### 3.3. 資産データ API

#### 3.3.1. 資産データの取得

- **URL**: `/api/v1/assets`
- **メソッド**: `GET`
- **リクエストヘッダー**:
  - `Authorization`: `Bearer {jwt_token}`
- **レスポンス**:
  - 成功:
    - 資産のリスト（資産名、金額、割合など）
  - 失敗:
    - エラーメッセージ: 認証エラー

#### 3.3.2. 資産データの更新

- **URL**: `/api/v1/assets`
- **メソッド**: `POST` または `PUT`
- **リクエストボディ**:
  - `asset_name`: 資産名
  - `amount`: 資産金額
  - `percentage`: 資産の割合
- **レスポンス**:
  - 成功:
    - メッセージ: 資産の更新が成功したことを示すメッセージ
  - 失敗:
    - エラーメッセージ: 更新に失敗した理由

---

### 3.4. ポートフォリオ API

#### 3.4.1. ポートフォリオの取得

- **URL**: `/api/v1/portfolio`
- **メソッド**: `GET`
- **リクエストヘッダー**:
  - `Authorization`: `Bearer {jwt_token}`
- **レスポンス**:
  - 成功:
    - ポートフォリオデータ（資産名、目標割合、実績割合など）
  - 失敗:
    - エラーメッセージ: 認証エラー

---

## 4. エラーハンドリング

- **401 Unauthorized**:

  - 認証に失敗した場合、`Unauthorized` エラーが返却されます。
  - エラーレスポンス例:
    - `error`: "Unauthorized access"

- **400 Bad Request**:

  - リクエストパラメータが不正な場合、`Bad Request` エラーが返却されます。
  - エラーレスポンス例:
    - `error`: "Invalid request parameters"

- **500 Internal Server Error**:
  - サーバー内部のエラーが発生した場合、`Internal Server Error` エラーが返却されます。
  - エラーレスポンス例:
    - `error`: "An unexpected error occurred"

---

## 5. レート制限

- **リクエスト制限**:
  - API に対するリクエストは、1 分あたり 100 回までとします。
  - 制限を超えた場合、`429 Too Many Requests` エラーを返却します。

---

## 6. CORS 設定

- **CORS**: 許可されたオリジンからのリクエストのみを受け入れる設定を行います。
  - 許可されたオリジン: `https://your-app-domain.com`
  - その他のオリジンからのリクエストには`403 Forbidden`エラーを返却します。

---

## 7. その他

- **バージョン管理**: `/api/v1/`を URL に含め、将来のバージョン管理を行います。
- **データ形式**: すべてのリクエストおよびレスポンスは JSON 形式で送受信します。
